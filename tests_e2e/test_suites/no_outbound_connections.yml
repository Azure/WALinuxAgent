#
# This suite is used to test the scenario where outbound connections are blocked on the VM.
#
# The suite uses a custom ARM template to create a VM with a Network Security Group that blocks all outbound
# connections. The first test in the suite verifies that the setup of the NSG was successful, then the rest
# of the tests exercise different extension operations. The last test ensures that the agent does not switch to
# direct download by default when there are HGAP download failures.
#
name: "NoOutboundConnections"
tests:
  - source: "no_outbound_connections/check_no_outbound_connections.py"
    blocks_suite: true  # If the NSG is not setup correctly, there is no point in executing the rest of the tests.
  - "agent_bvt/extension_operations.py"
  - "agent_bvt/run_command.py"
  - "agent_bvt/vm_access.py"
  - "no_outbound_connections/check_does_not_switch_to_direct.py"
images: "random(endorsed)"
template: "no_outbound_connections/deny_outbound_connections.py"
owns_vm: true
