# Python package
# Create and test a Python package on multiple Python versions.
# Add steps that analyze code, save the dist with the build record, publish to a PyPI-compatible index, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

trigger:
- develop

variables:
  vmName: 'larohra-simpleLinuxVM'
  adminUsername: 'larohra'
  SSH_PUBLIC: "$(sshPublicKey)" # set in GUI variables
  rgName: 'larohra-dcr-v2-test$(Build.BuildId)'

  # Scenario List
  listOfScenarios: "{
        'scenarioA': {
          'scenarioName': 'scenarioA'
        },
        'scenarioB': {
          'scenarioName': 'scenarioB'
        },
        'scenarioC': {
          'scenarioName': 'scenarioC'
        },
        'scenarioD': {
          'scenarioName': 'scenarioD'
        },
        'scenarioE': {
          'scenarioName': 'scenarioE'
        }
      }"

  # Cloud Data
  azureConnection: 'AzLinux DCR Public (8e037ad4-618f-4466-8bc8-5099d41ac15b)'
  subId: '8e037ad4-618f-4466-8bc8-5099d41ac15b'
  location: 'East US 2'

  fairfaxConn: 'VMGuestAgentAndExtensionsFairfax (8e5abcac-74f0-4955-9dfb-fe3fe36f8d19)'
  fairfaxSub: '8e5abcac-74f0-4955-9dfb-fe3fe36f8d19'

  mooncakeConn: 'Guest Agent Mooncake ( 557a8daa-8ac8-4caa-88e4-3b6f939978b9 )'
  mooncakeSub: '557a8daa-8ac8-4caa-88e4-3b6f939978b9'

#  azureConnection: '$(mooncakeConn)'
#  subId: '557a8daa-8ac8-4caa-88e4-3b6f939978b9'
#  location: 'china north 2'
  # azureConnection: 'VMGuestAgentAndExtensionsFairfax (8e5abcac-74f0-4955-9dfb-fe3fe36f8d19)' #'AzLinux DungeonCrawler(8e037ad4-618f-4466-8bc8-5099d41ac15b)'
  # subId: '8e5abcac-74f0-4955-9dfb-fe3fe36f8d19' #'8e037ad4-618f-4466-8bc8-5099d41ac15b'
  # location: 'usgovarizona' # 'East US 2'

pool: #larohra-dcrvmsspool
  vmImage: ubuntu-latest

steps:
  - bash: |
      touch abc.py bcd.py cde.py
      echo "##vso[task.setvariable variable=files;isOutput=true]($(ls *.py))"

  - template:  dcr/templates/test-files.yml
    parameters:
      files: $(files)
