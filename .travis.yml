---
os: linux
dist: xenial
language: python

matrix:
  allow_failures:
    - python: nightly
      env:
        - NOSEOPTS=--no-skip
        - SETUPOPTS=flake8

  include:
    - python: 2.6
      dist: trusty
      env:
        - NOSEOPTS=--no-skip
        - SETUPOPTS=
    - python: 2.7
      env:
        - NOSEOPTS=--no-skip
        - SETUPOPTS=flake8
    - python: 3.4
      env:
        - NOSEOPTS=--no-skip
        - SETUPOPTS=flake8
    - python: 3.5
      env:
        - NOSEOPTS=--no-skip
        - SETUPOPTS=flake8
    - python: 3.6
      env:
        - NOSEOPTS=--no-skip
        - SETUPOPTS=flake8
    - python: 3.7
      env:
        - >-
          NOSEOPTS=--no-skip --with-coverage --cover-inclusive
          --cover-min-percentage=60 --cover-branches 
          --cover-package=azurelinuxagent --cover-xml
        - SETUPOPTS=flake8
    - python: nightly
      env:
        - NOSEOPTS=--no-skip
        - SETUPOPTS=flake8

install:
  - pip install -r requirements.txt
  - pip install -r test-requirements.txt

script:
  # future: - pylint setup.py makepkg.py azurelinuxagent/
  - nosetests ${NOSEOPTS} tests
  - /usr/bin/env python setup.py check ${SETUPOPTS}

after_success:
  - if [[ $TRAVIS_PYTHON_VERSION == 3.7 ]]; then codecov; fi
