parameters:
  - name: sshCommand
    type: string
    default: "ssh -o StrictHostKeyChecking=no $(adminUsername)@$(armDeploymentOutput.hostname.value) sudo time python3 /home/$(adminUsername)/dcr/$(scenarioName)/{0}.py>$(Build.ArtifactStagingDirectory)/$(scenarioName)/{0}.stdout 2>$(Build.ArtifactStagingDirectory)/$(scenarioName)/{0}.stderr || (ec=$? && echo $ec > $(Build.ArtifactStagingDirectory)/$(scenarioName)/{0}.returncode && exit $ec)"

steps:
  - script: ${{ format(parameters.sshCommand, '01_check_waagent_version') }}
    name: 'checkVersion'
  - script: ${{ format(parameters.sshCommand, '03_check_nslookup') }}
    condition: succeededOrFailed()
  - script: |
      ls $(Build.ArtifactStagingDirectory)/*
      echo "STDOUT:"
      cat $(Build.ArtifactStagingDirectory)/$(scenarioName)/*.stdout
      echo "STDERR:"
      cat $(Build.ArtifactStagingDirectory)/$(scenarioName)/*.stderr
    condition: succeededOrFailed()



